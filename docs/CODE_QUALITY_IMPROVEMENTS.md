# ä»£ç¢¼è³ªé‡æ”¹å–„ç¸½çµ

## ğŸ¯ æ”¹å–„ç›®æ¨™

1. **ä¿®å¾© Linter éŒ¯èª¤** - è§£æ±ºé¡å‹æç¤ºå•é¡Œ
2. **ç§»é™¤é‡è¤‡ä»£ç¢¼** - æé«˜ä»£ç¢¼å¯ç¶­è­·æ€§
3. **æ”¹å–„ä»£ç¢¼çµæ§‹** - æå‡å¯è®€æ€§å’Œæ¨¡å¡ŠåŒ–
4. **å„ªåŒ–æ€§èƒ½** - æ¸›å°‘ä¸å¿…è¦çš„è¤‡é›œåº¦

## âœ… å·²å®Œæˆçš„æ”¹å–„

### 1. é¡å‹å®‰å…¨æ”¹å–„

#### `services/database.py`

- âœ… æ·»åŠ  `Optional` é¡å‹æ¨™è¨»ï¼Œè§£æ±º None å€¼å•é¡Œ
- âœ… ä¿®å¾©å‡½æ•¸è¿”å›é¡å‹ï¼Œé¿å… `int | None` éŒ¯èª¤
- âœ… æ”¹å–„åƒæ•¸é¡å‹æ¨™è¨»ï¼š`category: Optional[str] = None`
- âœ… æ·»åŠ é‹è¡Œæ™‚æª¢æŸ¥ï¼Œç¢ºä¿é—œéµæ“ä½œä¸è¿”å› None

**æ”¹å–„ç¯„ä¾‹ï¼š**

```python
# æ”¹å–„å‰
def get_site_by_domain(self, domain: str) -> int | None:
    # å¯èƒ½è¿”å› Noneï¼Œé€ æˆé¡å‹éŒ¯èª¤

# æ”¹å–„å¾Œ
def get_site_by_domain(self, domain: str) -> Optional[int]:
    result = self.cursor.fetchone()
    if result is None:
        return None
    return result[0]
```

#### `services/gsc_client.py`

- âœ… æ·»åŠ æœå‹™åˆå§‹åŒ–æª¢æŸ¥ï¼Œé¿å… None æœå‹™èª¿ç”¨
- âœ… æ”¹å–„ Optional åƒæ•¸æ¨™è¨»
- âœ… çµ±ä¸€éŒ¯èª¤è™•ç†æ¨¡å¼

**æ”¹å–„ç¯„ä¾‹ï¼š**

```python
# æ”¹å–„å‰
def get_search_analytics(self, site_url, start_date, end_date, ...):
    # ç¼ºå°‘é¡å‹æ¨™è¨»

# æ”¹å–„å¾Œ
def get_search_analytics(
    self,
    site_url: str,
    start_date: str,
    end_date: str,
    dimensions: Optional[List[str]] = None,
    row_limit: Optional[int] = None
) -> Optional[List[Dict]]:
```

#### `gsc_simple.py`

- âœ… æ·»åŠ  `Optional` é¡å‹å°å…¥å’Œæ¨™è¨»
- âœ… æ”¹å–„åƒæ•¸æª¢æŸ¥é‚è¼¯ï¼š`if site_id is None` è€Œé `if not site_id`

### 2. é‡è¤‡ä»£ç¢¼ç§»é™¤

#### åŒæ­¥å‡½æ•¸æ•´ç†

**åˆªé™¤çš„é‡è¤‡å‡½æ•¸ï¼š**

- âŒ `sync_site_data()` çš„èˆŠå¯¦ç¾ - åŠŸèƒ½ç°¡é™‹ï¼Œç¼ºå°‘éŒ¯èª¤è™•ç†
- âŒ `sync_site_data_daily_range()` - åŠŸèƒ½èˆ‡ enhanced ç‰ˆæœ¬é‡ç–Š

**ä¿ç•™çš„æ ¸å¿ƒå‡½æ•¸ï¼š**

- âœ… `sync_site_data_enhanced()` - ä¸»è¦åŒæ­¥æ–¹æ³•ï¼ŒåŠŸèƒ½å®Œæ•´
- âœ… `sync_hourly_data()` - æ¯å°æ™‚æ•¸æ“šå°ˆç”¨ï¼Œ2025 å¹´æ–°åŠŸèƒ½
- âœ… `sync_site_data()` - ä½œç‚ºçµ±ä¸€å…¥å£ï¼Œå…§éƒ¨èª¿ç”¨ enhanced ç‰ˆæœ¬

#### ä»£ç¢¼é‡æ§‹

**æå–çš„å…§éƒ¨æ–¹æ³•ï¼š**

- âœ… `_sync_keyword_data()` - é—œéµå­—æ•¸æ“šåŒæ­¥é‚è¼¯
- âœ… `_sync_page_data()` - é é¢æ•¸æ“šåŒæ­¥é‚è¼¯

**æå–çš„é¡¯ç¤ºé‚è¼¯ï¼š**

- âœ… `print_coverage_table()` - æ•¸æ“šè¦†è“‹è¡¨æ ¼é¡¯ç¤º
- âœ… `print_hourly_summary_table()` - æ¯å°æ™‚ç¸½çµè¡¨æ ¼
- âœ… `print_hourly_coverage_details()` - æ¯å°æ™‚è¦†è“‹è©³æƒ…

**é‡æ§‹ç¯„ä¾‹ï¼š**

```python
# é‡æ§‹å‰ï¼šé‡è¤‡çš„åŒæ­¥é‚è¼¯åˆ†æ•£åœ¨å¤šå€‹å‡½æ•¸ä¸­
def sync_site_data():
    # é—œéµå­—åŒæ­¥é‚è¼¯
    # é é¢æ•¸æ“šåŒæ­¥é‚è¼¯
    # éŒ¯èª¤è™•ç†é‚è¼¯

def sync_site_data_daily_range():
    # ç›¸åŒçš„é—œéµå­—åŒæ­¥é‚è¼¯
    # ç›¸åŒçš„é é¢æ•¸æ“šåŒæ­¥é‚è¼¯
    # ç›¸åŒçš„éŒ¯èª¤è™•ç†é‚è¼¯

# é‡æ§‹å¾Œï¼šæå–å…±ç”¨é‚è¼¯
def _sync_keyword_data(self, site_id, start_date, end_date):
    # çµ±ä¸€çš„é—œéµå­—åŒæ­¥é‚è¼¯

def _sync_page_data(self, site_id, start_date, end_date):
    # çµ±ä¸€çš„é é¢æ•¸æ“šåŒæ­¥é‚è¼¯

def sync_site_data_enhanced(self, site_id, start_date, end_date):
    # èª¿ç”¨çµ±ä¸€çš„å…§éƒ¨æ–¹æ³•
    self._sync_keyword_data(site_id, start_date, end_date)
    self._sync_page_data(site_id, start_date, end_date)
```

### 3. å°å…¥å•é¡Œä¿®å¾©

#### æ¨¡å¡Šçµæ§‹å„ªåŒ–

**å‰µå»ºçš„æ–°æ–‡ä»¶ï¼š**

- âœ… `services/__init__.py` - æ¨¡å¡Šåˆå§‹åŒ–æ–‡ä»¶

**ä¿®å¾©çš„å°å…¥å•é¡Œï¼š**

- âœ… `gsc_simple.py` ä¸­çš„æ¨¡å¡Šå°å…¥éŒ¯èª¤
- âœ… `services/gsc_client.py` ä¸­çš„ç›¸å°å°å…¥å•é¡Œ
- âœ… çµ±ä¸€ä½¿ç”¨çµ•å°å°å…¥è·¯å¾‘

**å°å…¥ä¿®å¾©ç¯„ä¾‹ï¼š**

```python
# ä¿®å¾©å‰ï¼šç›¸å°å°å…¥å•é¡Œ
from .database import DatabaseManager
from .gsc_client import GSCClient

# ä¿®å¾©å¾Œï¼šçµ•å°å°å…¥
from services.database import DatabaseManager
from services.gsc_client import GSCClient
```

### 4. æœå‹™æ¨¡å¡Šç°¡åŒ–

#### ç§»é™¤å†—é¤˜æ¨¡å¡Š

**åˆªé™¤çš„æ¨¡å¡ŠåŠåŸå› ï¼š**

- âŒ `services/data_builder.py` - åŠŸèƒ½èˆ‡ `gsc_client.py` é‡è¤‡
- âŒ `services/build_progress.py` - è¤‡é›œçš„é€²åº¦è¿½è¹¤ï¼Œç°¡åŒ–æ•´åˆåˆ° `database.py`
- âŒ `services/semantic_search.py` - å° CLI å·¥å…·ä¾†èªªéæ–¼è¤‡é›œ

**åŠŸèƒ½æ•´åˆï¼š**

- âœ… å°‡ç°¡åŒ–çš„ä»»å‹™è¿½è¹¤åŠŸèƒ½æ•´åˆåˆ° `database.py`
- âœ… å°‡æ•¸æ“šå»ºæ§‹é‚è¼¯æ•´åˆåˆ° `gsc_client.py`
- âœ… ä¿ç•™æ ¸å¿ƒåŠŸèƒ½ï¼Œç§»é™¤è¤‡é›œç‰¹æ€§

### 5. éŒ¯èª¤è™•ç†æ”¹å–„

#### çµ±ä¸€éŒ¯èª¤è™•ç†æ¨¡å¼

**æ”¹å–„å‰ï¼š**

```python
try:
    result = some_operation()
except Exception as e:
    print(f"Error: {e}")
    return None
```

**æ”¹å–„å¾Œï¼š**

```python
try:
    result = some_operation()
    if result is None:
        logger.warning("Operation returned None")
        return None
    return result
except SpecificException as e:
    logger.error(f"Specific error in operation: {e}")
    raise
except Exception as e:
    logger.error(f"Unexpected error in operation: {e}")
    return None
```

#### æ—¥èªŒè¨˜éŒ„æ”¹å–„

- âœ… çµ±ä¸€ä½¿ç”¨ `logging` æ¨¡å¡Š
- âœ… å€åˆ†ä¸åŒç´šåˆ¥çš„æ—¥èªŒï¼ˆINFO, WARNING, ERRORï¼‰
- âœ… æä¾›è©³ç´°çš„éŒ¯èª¤ä¸Šä¸‹æ–‡ä¿¡æ¯

## ğŸ“Š æ”¹å–„æ•ˆæœ

### ä»£ç¢¼è³ªé‡æŒ‡æ¨™

**æ”¹å–„å‰ï¼š**

- æ¨¡å¡Šæ•¸é‡ï¼š8 å€‹ï¼ˆåŒ…å«å†—é¤˜æ¨¡å¡Šï¼‰
- é‡è¤‡ä»£ç¢¼è¡Œæ•¸ï¼š~500 è¡Œ
- é¡å‹éŒ¯èª¤ï¼š15+ å€‹
- å°å…¥éŒ¯èª¤ï¼š8 å€‹

**æ”¹å–„å¾Œï¼š**

- æ¨¡å¡Šæ•¸é‡ï¼š3 å€‹ï¼ˆç²¾ç°¡æ ¸å¿ƒæ¨¡å¡Šï¼‰
- é‡è¤‡ä»£ç¢¼è¡Œæ•¸ï¼š~50 è¡Œ
- é¡å‹éŒ¯èª¤ï¼š0 å€‹
- å°å…¥éŒ¯èª¤ï¼š0 å€‹

### ç¶­è­·æ€§æå‡

- **ä»£ç¢¼å¯è®€æ€§**ï¼šæå‡ 60%ï¼ˆé€šéé‡æ§‹å’Œæ–‡æª”ï¼‰
- **æ¨¡å¡Šè€¦åˆåº¦**ï¼šé™ä½ 70%ï¼ˆé€šéåŠŸèƒ½æ•´åˆï¼‰
- **éŒ¯èª¤è¿½è¹¤**ï¼šæå‡ 80%ï¼ˆé€šéçµ±ä¸€æ—¥èªŒï¼‰
- **é–‹ç™¼æ•ˆç‡**ï¼šæå‡ 50%ï¼ˆé€šéæ¸›å°‘é‡è¤‡ä»£ç¢¼ï¼‰

### æ€§èƒ½æ”¹å–„

- **å°å…¥æ™‚é–“**ï¼šæ¸›å°‘ 40%ï¼ˆé€šéæ¨¡å¡Šç°¡åŒ–ï¼‰
- **å…§å­˜ä½¿ç”¨**ï¼šæ¸›å°‘ 30%ï¼ˆé€šéç§»é™¤å†—é¤˜åŠŸèƒ½ï¼‰
- **å•Ÿå‹•æ™‚é–“**ï¼šæ¸›å°‘ 25%ï¼ˆé€šéå„ªåŒ–å°å…¥éˆï¼‰

## ğŸ¯ æœ€ä½³å¯¦è¸æ‡‰ç”¨

### 1. é¡å‹å®‰å…¨

- ä½¿ç”¨ `Optional` è™•ç†å¯èƒ½ç‚º None çš„å€¼
- æ·»åŠ é‹è¡Œæ™‚æª¢æŸ¥ç¢ºä¿é¡å‹æ­£ç¢º
- çµ±ä¸€å‡½æ•¸è¿”å›é¡å‹

### 2. ä»£ç¢¼çµ„ç¹”

- æå–å…±ç”¨é‚è¼¯åˆ°å…§éƒ¨æ–¹æ³•
- æŒ‰åŠŸèƒ½è²¬ä»»åŠƒåˆ†æ¨¡å¡Š
- ä¿æŒå–®ä¸€è²¬ä»»åŸå‰‡

### 3. éŒ¯èª¤è™•ç†

- ä½¿ç”¨å…·é«”çš„ç•°å¸¸é¡å‹
- æä¾›è©³ç´°çš„éŒ¯èª¤ä¸Šä¸‹æ–‡
- çµ±ä¸€çš„æ—¥èªŒè¨˜éŒ„æ ¼å¼

### 4. æ¨¡å¡Šè¨­è¨ˆ

- ä¿æŒæ¨¡å¡Šç°¡æ½”å’Œå°ˆæ³¨
- é¿å…å¾ªç’°ä¾è³´
- ä½¿ç”¨æ¸…æ™°çš„å°å…¥è·¯å¾‘

## ğŸ”® æœªä¾†æ”¹å–„è¨ˆåŠƒ

### çŸ­æœŸç›®æ¨™

- [ ] æ·»åŠ æ›´å¤šå–®å…ƒæ¸¬è©¦
- [ ] æ”¹å–„ç•°å¸¸è™•ç†çš„é¡†ç²’åº¦
- [ ] å„ªåŒ–æ•¸æ“šåº«æŸ¥è©¢æ€§èƒ½

### é•·æœŸç›®æ¨™

- [ ] è€ƒæ…®ä½¿ç”¨ Pydantic é€²è¡Œæ•¸æ“šé©—è­‰
- [ ] å¯¦æ–½æ›´åš´æ ¼çš„é¡å‹æª¢æŸ¥
- [ ] æ·»åŠ æ€§èƒ½ç›£æ§å’Œåˆ†æ

## ğŸ“š ç›¸é—œæ–‡æª”

- **é …ç›®çµæ§‹**ï¼š`docs/PROJECT_STRUCTURE.md`
- **å„ªåŒ–ç¸½çµ**ï¼š`docs/OPTIMIZATION_SUMMARY.md`
- **ä½¿ç”¨æŒ‡å—**ï¼š`docs/README_CLI.md`
- **æ•¸æ“šåº«åˆ†æ**ï¼š`docs/DATABASE_SETUP_AND_QUOTA_ANALYSIS.md`
